<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Social App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .post-card { transition: all 0.2s ease-in-out; }
        .post-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-start justify-center p-4">

    <div id="app" class="w-full max-w-2xl bg-white shadow-xl rounded-xl p-4 md:p-6 lg:p-8">
        <h1 class="text-4xl font-extrabold text-blue-700 mb-6 border-b-4 border-blue-100 pb-3">Micro Feed</h1>
        
        <!-- Post Creation Area -->
        <div class="mb-8 p-4 bg-blue-50 rounded-lg shadow-inner">
            <textarea id="postContent" placeholder="What's on your mind? (Max 280 chars)" maxlength="280"
                      class="w-full p-3 border border-blue-200 rounded-lg resize-none focus:ring-blue-500 focus:border-blue-500 text-sm h-20 transition duration-150"></textarea>
            <div class="flex justify-end mt-2">
                <button id="postButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-full shadow-md transition duration-200 ease-in-out transform hover:scale-[1.03]">
                    Post Now
                </button>
            </div>
        </div>

        <!-- Controls (Search & Sort) -->
        <div class="flex flex-col sm:flex-row gap-3 mb-6">
            <input type="text" id="searchInput" placeholder="Search posts..."
                   class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
            
            <select id="sortSelect" class="p-2 border border-gray-300 rounded-lg bg-white text-sm">
                <option value="date-desc">Newest First</option>
                <option value="date-asc">Oldest First</option>
                <option value="likes-desc">Most Liked</option>
            </select>
        </div>

        <!-- Posts Container -->
        <div id="postsContainer" class="space-y-4">
            <!-- Posts will be rendered here -->
        </div>

        <div id="emptyMessage" class="hidden text-center text-gray-500 mt-10 p-6 border-2 border-dashed border-gray-300 rounded-xl">
            No posts found. Be the first to post!
        </div>
    </div>

    <script>
        const POSTS_KEY = 'microSocialPosts';
        let posts = [];

        // Utility functions
        const $ = selector => document.querySelector(selector);
        const $$ = selector => document.querySelectorAll(selector);

        // DOM elements
        const postsContainer = $('#postsContainer');
        const postContent = $('#postContent');
        const postButton = $('#postButton');
        const searchInput = $('#searchInput');
        const sortSelect = $('#sortSelect');
        const emptyMessage = $('#emptyMessage');

        // --- Data Persistence and Loading ---

        /** Loads posts from localStorage or returns an empty array. */
        function loadPosts() {
            try {
                const storedPosts = localStorage.getItem(POSTS_KEY);
                posts = storedPosts ? JSON.parse(storedPosts) : [];
                // Ensure 'likes' is a number
                posts = posts.map(p => ({ ...p, likes: p.likes || 0 }));
            } catch (e) {
                console.error("Error loading posts from localStorage:", e);
                posts = [];
            }
        }

        /** Saves the current posts array to localStorage. */
        function savePosts() {
            localStorage.setItem(POSTS_KEY, JSON.stringify(posts));
        }

        // --- CRUD Operations ---

        /** Creates a new post. */
        function createPost() {
            const content = postContent.value.trim();
            if (content.length === 0) return;

            const newPost = {
                id: Date.now(),
                content: content,
                timestamp: new Date().toISOString(),
                likes: 0
            };

            posts.unshift(newPost); // Add to the beginning
            savePosts();
            postContent.value = '';
            renderPosts();
        }

        /** Toggles the like status (for simplicity, we just increment/decrement). */
        function toggleLike(id) {
            const postIndex = posts.findIndex(p => p.id === id);
            if (postIndex > -1) {
                // Simple implementation: just increment the like count
                posts[postIndex].likes++;
                savePosts();
                renderPosts();
            }
        }

        /** Deletes a post by ID. */
        function deletePost(id) {
            if (!window.confirm("Are you sure you want to delete this post?")) return;
            posts = posts.filter(p => p.id !== id);
            savePosts();
            renderPosts();
        }

        // --- Rendering and Filtering ---

        /** Filters and sorts the posts based on current controls. */
        function getFilteredAndSortedPosts() {
            const searchTerm = searchInput.value.toLowerCase();
            const sortBy = sortSelect.value;

            // 1. Filter
            let filtered = posts.filter(post => 
                post.content.toLowerCase().includes(searchTerm)
            );

            // 2. Sort
            if (sortBy === 'date-desc') {
                filtered.sort((a, b) => b.id - a.id);
            } else if (sortBy === 'date-asc') {
                filtered.sort((a, b) => a.id - b.id);
            } else if (sortBy === 'likes-desc') {
                filtered.sort((a, b) => b.likes - a.likes);
            }

            return filtered;
        }

        /** Renders all posts to the DOM. */
        function renderPosts() {
            const renderedPosts = getFilteredAndSortedPosts();
            postsContainer.innerHTML = '';
            emptyMessage.classList.toggle('hidden', renderedPosts.length > 0);

            renderedPosts.forEach(post => {
                const date = new Date(post.timestamp).toLocaleString();
                
                const postElement = document.createElement('div');
                postElement.id = `post-${post.id}`;
                postElement.className = 'post-card p-4 bg-white border border-gray-200 rounded-lg shadow-sm';
                postElement.innerHTML = `
                    <p class="text-gray-800 text-base mb-3 leading-relaxed whitespace-pre-wrap">${post.content}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500 border-t pt-2 mt-2">
                        <span class="text-blue-500">${date}</span>
                        <div class="flex space-x-4">
                            <!-- Like Button -->
                            <button class="flex items-center space-x-1 text-gray-600 hover:text-red-500 transition duration-150 like-btn" data-id="${post.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 fill-current" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                </svg>
                                <span class="font-bold text-sm">${post.likes}</span>
                            </button>
                            <!-- Delete Button -->
                            <button class="text-gray-400 hover:text-red-700 transition duration-150 delete-btn" data-id="${post.id}">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
                postsContainer.appendChild(postElement);
            });
            
            // Re-attach event listeners after rendering
            $$('.like-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    toggleLike(id);
                });
            });
            $$('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    deletePost(id);
                });
            });
        }

        // --- Initialization and Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            loadPosts();
            renderPosts();

            postButton.addEventListener('click', createPost);
            
            searchInput.addEventListener('input', renderPosts);
            sortSelect.addEventListener('change', renderPosts);
            
            // Allow posting with Enter key
            postContent.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    createPost();
                }
            });
        });
    </script>
</body>
</html>